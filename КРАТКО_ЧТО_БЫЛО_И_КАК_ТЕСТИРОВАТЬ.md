# üéØ –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê: –ß–¢–û –ë–´–õ–û –ù–ï –¢–ê–ö –ò –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê #1: –¢–†–ò–ê–õ –ù–ï –†–ê–ë–û–¢–ê–õ (–ò–°–ü–†–ê–í–õ–ï–ù–û!)

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫:
–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–ª —Å—Ç–∞—Ç—É—Å —Ç—Ä–∏–∞–ª–∞ –∫–∞–∫ `'trialing'`, –Ω–æ –≤ –±–∞–∑–µ –∏ Stripe –æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `'trial'`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–ª–æ–≤–∏–µ –ù–ò–ö–û–ì–î–ê –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ ‚Üí –¥–∏–ª–µ—Ä—ã –º–æ–≥–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–∞–∂–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è 7 –¥–Ω–µ–π –±–µ–∑ –æ–ø–ª–∞—Ç—ã!

### –ì–¥–µ –±—ã–ª –±–∞–≥:
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±—ã–ª–æ):
if (subscription_status === 'trialing') { ... }

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
if (subscription_status === 'trial') { ... }
```

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:
- `src/app/dealer/add-listing/page.tsx` (4 –º–µ—Å—Ç–∞)
- `src/app/dealer/my-listings/page.tsx` (1 –º–µ—Å—Ç–æ)  
- `src/app/dealer/dashboard/page.tsx` (6 –º–µ—Å—Ç)

**–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç—Ä–∏–∞–ª–∞ –¥–∏–ª–µ—Ä –ù–ï —Å–º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–æ–∫—É–ø–∫–∏ –ø–∞–∫–µ—Ç–∞! ‚úÖ**

---

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê #2: –û–ü–õ–ê–¢–ê STRIPE

### –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:
–°–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã **—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**! –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Stripe –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è.

**–í .env.local —É–∂–µ —Å—Ç–æ—è—Ç –¢–ï–°–¢–û–í–´–ï –∫–ª—é—á–∏ ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!**

```bash
STRIPE_SECRET_KEY=sk_test_...  # ‚Üê –¢–ï–°–¢–û–í–´–ô, –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏
```

---

## üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –ë–ï–ó –†–ï–ê–õ–¨–ù–´–• –î–ï–ù–ï–ì

### –°–ø–æ—Å–æ–± 1: –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Stripe (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π!)

–ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π:

```
üí≥ –£–°–ü–ï–®–ù–ê–Ø –û–ü–õ–ê–¢–ê:
–ù–æ–º–µ—Ä:  4242 4242 4242 4242
CVV:    123
–°—Ä–æ–∫:   12/34
ZIP:    12345

üí≥ –û–¢–ö–õ–û–ù–Å–ù–ù–ê–Ø –ö–ê–†–¢–ê:
–ù–æ–º–µ—Ä:  4000 0000 0000 0002
```

**–í–°–Å –ë–ï–°–ü–õ–ê–¢–ù–û!** Stripe test mode –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏.

–ë–æ–ª—å—à–µ –∫–∞—Ä—Ç: https://docs.stripe.com/testing#cards

---

### –°–ø–æ—Å–æ–± 2: SQL-—Å–∫—Ä–∏–ø—Ç—ã (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

–û—Ç–∫—Ä–æ–π **Supabase ‚Üí SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- 1Ô∏è‚É£ –£–∑–Ω–∞–π —Å–≤–æ–π user_id
SELECT user_id, subscription_status, trial_end_date
FROM dealers
WHERE user_id IN (
  SELECT user_id FROM user_profiles WHERE email = '—Ç–≤–æ–π@email.com'
);

-- 2Ô∏è‚É£ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª (7 –¥–Ω–µ–π)
UPDATE dealers 
SET 
  subscription_status = 'trial',
  trial_end_date = NOW() + INTERVAL '7 days',
  current_tier_id = 'tier_100'
WHERE user_id = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_–¢–í–û–ô_USER_ID';

-- 3Ô∏è‚É£ –ò—Å—Ç–µ—á—å —Ç—Ä–∏–∞–ª (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!)
UPDATE dealers 
SET trial_end_date = NOW() - INTERVAL '1 day'
WHERE user_id = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_–¢–í–û–ô_USER_ID';
-- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è!

-- 4Ô∏è‚É£ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
UPDATE dealers 
SET 
  subscription_status = 'active',
  current_tier_id = 'tier_100',
  trial_end_date = NULL,
  subscription_start_date = NOW(),
  subscription_end_date = NOW() + INTERVAL '30 days'
WHERE user_id = '–í–°–¢–ê–í–¨_–°–Æ–î–ê_–¢–í–û–ô_USER_ID';
-- –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ 100 –æ–±—ä—è–≤–ª–µ–Ω–∏–π
```

**–í—Å–µ SQL-—Å–∫—Ä–∏–ø—Ç—ã:** –æ—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `dealer_test_queries.sql`

---

### –°–ø–æ—Å–æ–± 3: Node.js —Å–∫—Ä–∏–ø—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª
node test-stripe-webhook.js trial_started —Ç–≤–æ–π@email.com

# –ò—Å—Ç–µ—á—å —Ç—Ä–∏–∞–ª
node test-stripe-webhook.js trial_expired —Ç–≤–æ–π@email.com

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
node test-stripe-webhook.js subscription_active —Ç–≤–æ–π@email.com

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å
node test-stripe-webhook.js status —Ç–≤–æ–π@email.com
```

---

### –°–ø–æ—Å–æ–± 4: Stripe CLI (–ª–æ–∫–∞–ª—å–Ω—ã–µ webhooks)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ Stripe CLI (Windows):
# https://github.com/stripe/stripe-cli/releases

# –ó–∞–ø—É—Å—Ç–∏ —Ç—É–Ω–Ω–µ–ª—å
stripe listen --forward-to localhost:3000/api/dealer/webhooks/stripe

# –°–∏–º—É–ª–∏—Ä—É–π —Å–æ–±—ã—Ç–∏—è
stripe trigger customer.subscription.created
stripe trigger customer.subscription.trial_will_end
```

---

## üéØ –ë–´–°–¢–†–´–ô –¢–ï–°–¢ (5 –º–∏–Ω—É—Ç)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∏–∞–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –∫–∞–∫ –¥–∏–ª–µ—Ä
2. –í Supabase SQL Editor:
   ```sql
   -- –ê–∫—Ç–∏–≤–∏—Ä—É–π —Ç—Ä–∏–∞–ª
   UPDATE dealers 
   SET subscription_status = 'trial', 
       trial_end_date = NOW() + INTERVAL '7 days'
   WHERE user_id = (SELECT user_id FROM user_profiles WHERE email = '—Ç–≤–æ–π@email.com');
   ```
3. –î–æ–±–∞–≤—å 3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚úÖ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
4. –í SQL Editor:
   ```sql
   -- –ò—Å—Ç–µ—á—å —Ç—Ä–∏–∞–ª
   UPDATE dealers 
   SET trial_end_date = NOW() - INTERVAL '1 day'
   WHERE user_id = (SELECT user_id FROM user_profiles WHERE email = '—Ç–≤–æ–π@email.com');
   ```
5. –ü–æ–ø—Ä–æ–±—É–π –¥–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Üí **–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞!** üö´

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É (—Ç–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞)

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ `/dealer/subscription`
2. –í—ã–±–µ—Ä–∏ –ª—é–±–æ–π –ø–∞–∫–µ—Ç
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Stripe –∏—Å–ø–æ–ª—å–∑—É–π –∫–∞—Ä—Ç—É `4242 4242 4242 4242`
4. CVV: `123`, –°—Ä–æ–∫: `12/34`, ZIP: `12345`
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ ‚Üí **–¥–æ–ª–∂–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–ø–∏—Å–∫–∞!** ‚úÖ
6. –ü—Ä–æ–≤–µ—Ä—å –≤ Stripe Dashboard: https://dashboard.stripe.com/test/subscriptions

---

## üìä –°–¢–ê–¢–£–°–´ –ü–û–î–ü–ò–°–ö–ò

| –°—Ç–∞—Ç—É—Å | –ß—Ç–æ –∑–Ω–∞—á–∏—Ç | –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è? |
|--------|------------|----------------------------|
| `trial` + –¥–∞—Ç–∞ > —Å–µ–≥–æ–¥–Ω—è | –¢—Ä–∏–∞–ª –∞–∫—Ç–∏–≤–µ–Ω | ‚úÖ –î–∞, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ |
| `trial` + –¥–∞—Ç–∞ < —Å–µ–≥–æ–¥–Ω—è | –¢—Ä–∏–∞–ª –∏—Å—Ç—ë–∫ | üö´ –ù–µ—Ç, –Ω—É–∂–Ω–∞ –æ–ø–ª–∞—Ç–∞ |
| `active` | –û–ø–ª–∞—á–µ–Ω–æ | ‚úÖ –î–∞, –ø–æ –ª–∏–º–∏—Ç—É –ø–∞–∫–µ—Ç–∞ |
| `past_due` | –ü—Ä–æ—Å—Ä–æ—á–µ–Ω –ø–ª–∞—Ç—ë–∂ | ‚ö†Ô∏è Stripe –ø—Ä–æ–±—É–µ—Ç —Å–ø–∏—Å–∞—Ç—å |
| `canceled` | –û—Ç–º–µ–Ω–µ–Ω–∞ | üö´ –ù–µ—Ç |
| `inactive` | –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ | üö´ –ù–µ—Ç |

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–í—Å–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

1. **`DEALER_FIX_SUMMARY.md`** ‚Üê –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
2. **`DEALER_TESTING_GUIDE.md`** ‚Üê –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
3. **`dealer_test_queries.sql`** ‚Üê –í—Å–µ SQL-—Å–∫—Ä–∏–ø—Ç—ã
4. **`test-stripe-webhook.js`** ‚Üê Node.js —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

---

## üî• –ì–õ–ê–í–ù–û–ï

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
‚úÖ –¢—Ä–∏–∞–ª —Ç–µ–ø–µ—Ä—å **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç** –ø–æ—Å–ª–µ 7 –¥–Ω–µ–π  
‚úÖ –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å (`'trial'` –≤–º–µ—Å—Ç–æ `'trialing'`)  
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Stripe (4242...)  
‚úÖ –ò–ª–∏ SQL-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏  
‚úÖ –ò–ª–∏ Node.js —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏  

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏?
‚úÖ –î–∞! –í `.env.local` —Å—Ç–æ—è—Ç **–¢–ï–°–¢–û–í–´–ï** –∫–ª—é—á–∏ Stripe  
‚úÖ **–ù–∏–∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π** –Ω–µ –±—É–¥–µ—Ç  
‚úÖ –ú–æ–∂–µ—à—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ

---

## üÜò –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –¢—Ä–∏–∞–ª –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç?
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä
npm run clean
npm run dev
```

### –ù–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Stripe?
–ü—Ä–æ–≤–µ—Ä—å `.env.local`:
```bash
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç?
```bash
stripe listen --forward-to localhost:3000/api/dealer/webhooks/stripe
```

---

## ‚úÖ –ì–û–¢–û–í–û!

–¢–µ–ø–µ—Ä—å –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å! üéâ

**–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —Ç—Ä–∏–∞–ª –ø–æ –°—Ü–µ–Ω–∞—Ä–∏—é 1
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –æ–ø–ª–∞—Ç—É –ø–æ –°—Ü–µ–Ω–∞—Ä–∏—é 2 (—Ç–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ 4242...)
3. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –º–æ–∂–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–í–æ–ø—Ä–æ—Å—ã?** –û—Ç–∫—Ä–æ–π `DEALER_TESTING_GUIDE.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
